# (PART) Анализ данных {-}
# Описательные статистики

_Итак, мы загрузили данные, посмотрели на них, почистили --- пора приступить к внимательному изучению, чего мы там насобирали. Частично мы уже сталкивались с описательными статистиками в предыдущих главах --- теперь же будем разбираться подробно._

**Описательные статистики (descriptive statistics[^1])** --- обобщенные статистики, количественно описывающие особенности имеющихся данных.

**Описательная статистика (descriptive statistics[^2])** --- области статистики, занимающаяся обработкой статистических данных, их наглядным представлением, и собственно описанием через описательные статистики[^3].

**Зачем нам описательные статиски?** Чтобы ёмко описать имеющиеся данные и составить на основе этих описаний общее представление о них, а также обнаружить особенности, которые могут повлиять на дальнейший анализ.

> Слишком много описаний, поехали к делу уже!


## Меры центральной тенденции

Насколько ёмко мы хотим описать наши даннные? Ну, попробуем для начала максимально ёмко и максимально просто --- одним числом. Например, самым часто встречающимся наблюдением. Как мы будем это наблюдение искать, зависит от [шкалы]() конкретной переменной.

|**Шкала**|**Мера центральная тенденции**|
|:-------:|:----------------------------:|
|*Номинальная*|Мода|
|*Порядковая*|Медиана|
|*Интервальная*|Среднее арифметическое|
|*Абсолютная*|Среднее геометрическое и др.|

### Мода

**Мода (mode)** --- наиболее часто встречающееся значение данной переменной.

Тут все достаточно просто и интуитивно понятно. Пусть у нас есть следующий вектор наблюдений:

```{r}
x <- c(1,3,4,6,4,2,4,3,2,4,1)
```

Если мы составим таблицу частот по этому вектору, то получим следующее:
```{r}
table(x)
```

Очевидно, что $4$ всречается в векторе чаще других значений --- это и есть мода.

Также очевидно, что *моду невозможно посчитать на непрерывной шкале*.

<img class="taskimg" src="img/question.png">
<div class="task">
Почему?
</div>

К сожалению, в **R** нет встроенной функции для расчёта моды.

<img class="taskimg" src="img/code.png">
<div class="task">
Напишите функцию, которая принимает на вход вектор значений дискретной переменной, и вычисляет моду данной переменной[^4]. Если мод у данной переменной несколько, необходимо вернуть все.
</div>

Формально моду можно определить как значение переменной, при котором функция вероятности (probability mass function) принимает максимальное значение:

$$
\mathrm{mode} = \max(\mathrm{PMF}(X))
$$

### Медиана
Если мы уже гуляем на просторах порядковой шкалы, то можем посчитать медиану.

**Медиана (median)** --- это значение, которые располягается на середине сортированного[^5] вектора значений переменной. То есть, она делит все наблюдения переменной ровно пополам и 50% наблюдений оказывается по одну сторону от медианы, а 50% --- по другую. По этой причине медиана также называется *вторым [квартилем]()* распределения.

<img class="taskimg" src="img/question.png">
<div class="task">
Почему нельзя посчитать медиану на номинальной шкале?
</div>

Формальное определение медианы зависит от количества значений в векторе: если есть нечётное количество значений --- то это ровно середина сортированного вектора, если есть чётное количество наблюдение --- то медиана определяется как (арифметическое) среднее между двумя срединными наблюдениями.

$$
\mathrm{median} = \begin{cases}
X(\frac{n+1}{2}), \text{ if } n \text{ is odd},\\
\dfrac{X(\frac{n}{2}) + X(\frac{n}{2}+1)}{2}, \text{ otherwise},
\end{cases}
$$
где $X$ --- вектор налюдений данной переменной, $n$ --- число наблюдений, $X(a)$ --- наблюдение с индексом $a$ в сортированном векторе $X$.

Для вектора `x`, который был создан выше, расчёт медианы выглядит так:
```{r}
median(x)
```
Изи.


### Среднее
А ежели мы уже на уровне интервальной шкалы, что не грех и среднее посчитать. Вот только какое?

#### Арифметическое
Как правило, считается среднее арифметическое (поэтому если не указано иного, мы понимает под термином «среднее» именно «арифметическое среднее»), и далее люди не заморачиваются, что в целом разумно. По сему, мы уделим основное внимание ему, а другие посмотрим лишь обзорно.

С **арифметическим средним (arithmetic mean, mean, average)** все знакомы ещё со школы, и считается оно предельно просто --- суммируем все наблюдения и полученную сумму делим на количество наблюдений.

$$
\bar X = \dfrac{\sum_{i=1}^{n}x_i}{n},
$$
где $\bar X$ --- среднее арифметическое, $x_i$ --- наблюдение в векторе $X$, $n$ --- количество наблюдений.

В **R** оно считается абсолютно элементарно:
```{r}
mean(x)
```
Кстати, оценка генерального среднего через выборочное среднее --- это один из примеров [точечной оценки]() параметра [методом моментов]().

Давайте сравним для рассмотреные статистики (используем все тот же вектор `x`):
```{r, echo=FALSE}
# mode function
mode <- function(x) {
  values <- sort(unique(x))
  freqs <- tabulate(x)
  which(freqs == max(freqs))
}
```
```{r}
mode(x) # кастомная функция, отсутствует в R
median(x)
mean(x)
```
Как мы видим, хотя все три статистики описывают цкентральную тенденцию, тем не менее они всё же дают разные результаты. Посмотрим их взаимное положение на графике:
```{r, echo=FALSE}
library(ggplot2)
theme_set(theme_bw())
set.seed(108)
symm <- sample(
  x = seq(1, 10, 0.5),
  size = 200,
  replace = TRUE,
  prob = c(
    .05,
    .05,
    .07,
    .1,
    .1,
    .15,
    .20,
    .30,
    .35,
    .5,
    .35,
    .30,
    .20,
    .15,
    .1,
    .1,
    .07,
    .05,
    .05
  )
)
asymm <- sample(
  x = seq(1, 10, 0.5),
  size = 200,
  replace = TRUE,
  prob = c(
    .1,
    .2,
    .25,
    .4,
    .5,
    .5,
    .4,
    .35,
    .3,
    .25,
    .2,
    .25,
    .2,
    .15,
    .1,
    .1,
    .07,
    .05,
    .05
  )
)
ggplot(NULL) +
  geom_density(aes(symm)) +
  geom_density(aes(asymm), linetype = 'dashed') +
  geom_vline(xintercept = mean(symm), color = 'darkred') +
  geom_vline(xintercept = median(symm), color = 'darkblue') +
  geom_vline(xintercept = mode(symm), color = 'darkgreen') +
  geom_vline(xintercept = mean(asymm), color = 'darkred', linetype = 'dashed') +
  geom_vline(xintercept = median(asymm), color = 'darkblue', linetype = 'dashed') +
  geom_vline(xintercept = mode(asymm), color = 'darkgreen', linetype = 'dashed') +
  labs(x = 'Value',
       y = 'Density')
  
```
<center style="margin-top: -2%;">
<div style="display:inline-block; margin-right: 1%; color: #7f170e; font-size: 12px;">mean</div>
<div style="display:inline-block; margin-right: 1%; color: #000d85; font-size: 12px;">median</div>
<div style="display:inline-block; color: #2a6218; font-size: 12px;">mode</div>
</center>

Что тут можно пронаблюдать? Во-первых, есть два распределения --- более симметричное (сплошная чёрная линия) и сильно скошенное (прерывистая чёрная линия). 

#### Геометрическое
#### Гармоническое
#### Квадратичное
#### Усеченное
#### Межквартильное

> На этом список средних не заканчивается, но нам обозначенных выше нам будет более чем достаточно.



[^1]: Count noun, plural in this case
[^2]: Mass (uncountable) noun
[^3]: Обычно противоставляется статистическому выводу (inferential statistics), потому что не делает никаких заключений на основе данных, а просто говорит, что вот жанные такие, какие они есть.
[^4]: Обратите внимание на функцию `tabulate()`.
[^5]: Здесь важно помнить о нюансах терминов «упорядоченный» и «сортированный». *Упорядоченный* ряд наблюдений --- это ряд чисел, на котором задан определенный порядок (например, по ID испытуемого --- 1, 2, 3, 4, …), а *сортированный ряд наблюдений* --- это ряд, упорядоченный по возрастанию или убыванию.