# (PART) R programming {-}
# Знакомство с R и RStudio

> _--- Я вот не могу выбрать: делать на R или на Python? <br>
> --- Да какая разница! Главное --- делай!_

## Что это и откуда?

[**R**](https://www.r-project.org/) --- популярный язык программирования среди исследователей в социальных и гуманитарных науках. Если совсем коротко, то начиналось всё с языка [**S**](https://en.wikipedia.org/wiki/S_(programming_language)), который был языком программирования для статистического анализа. Потом его [доработали](https://www.researchgate.net/publication/240040602_Evaluating_the_Design_of_the_R_Language) и получился **R**.

Хотя сегодня всё ещё можно услышать, что «R --- это язык программирования для статистической обработки данных», это [ложь](https://en.wikipedia.org/wiki/False_(logic)). Да, когда-то [давно](https://en.wikipedia.org/wiki/Devonian) дела обстояли именно так, но сейчас **R** --- это полноценный язык программирования, который позволяет решать широкий спект задач от статистического анализа и data wrangling до машинного обучения, моделирования и создания сайтов и приложений.


## Почему R?

* свободное ПО (часть [GNU Project](https://en.wikipedia.org/wiki/GNU_Project))
* динамично развивается
* громадные возможности расширения функционала
  + более 10 000 пакетов
  + открытый исходный код
  + возможность написать свои
<center>
![](img/img_number-of-submitted-packages-to-CRAN.png)
</center>
<font size=1>
<p align="right">[_Source_](https://gist.github.com/daroczig/3cf06d6db4be2bbe3368)</p>
</font>
* большое сообщество по всему миру, много ресурсов для задавания вопросов
* [Linear Warriors vs Quadratic Wizards](https://1d4chan.org/wiki/Linear_Warriors,_Quadratic_Wizards)
  + в SPSS (и другие GUI пакеты) ниже порог вхождения, но развитие навыков --- линейное
  + в R порог вхождения выше, но впоследствии случается резкий буст, и вы становитесь богами дата саенс

<center>
![](img/img_LinearWarriors_QuadraticWizards.png)
</center>
<font size=1>
<p align="right">[_Source_](https://1d4chan.org/wiki/Linear_Warriors,_Quadratic_Wizards)</p>
</font>

* [репродуцируемость](https://en.wikipedia.org/wiki/Reproducibility_Project) результатов

### А он лучше Питона?
<center>
![](img/img_R-Vs-Python-samaya-aktualnaya-diskussiya-dlya-nachinayushhih-uchenyh-dannyh.jpg)
</center>
<font size=1>
<p align="right">[_Source_](https://andreyex.ru/programmirovanie/r-vs-python-samaya-aktualnaya-diskussiya-dlya-nachinayushhih-uchenyh-dannyh/)</p>
</font>

Нет. Но он и **не хуже**.

Вообще файт **R vs Python**, на мой взгляд, несколько бессмысленный, поскольку, по факту, всё упирается в синтаксис языка. Ну, и запрос работодателя, конечно. Возможности обоих языков и скорость работы сопоставимы. Области применения по большей части тоже. Поэтому я пользуюсь следующей эвристикой:

* аналитика, статистика, графики, покрутить данные --- **R**
* машинное обучение, нейросети, другой ИИ, интерфейсы и [собственно] программирование --- **Python**

Многие, наверняка, оспорят такое разделение --- я же не стану отстаивать его истинность.

Мы будем работать на **R**, поскольку он всё же более популярен в наших кругах --- среди «социально-гуманитарных аналитиков».



## Установка R и RStudio

Чтобы нам радостно и приятно жилось, нужно установить:

* Сначала **R**
  + на [Windows](https://cran.r-project.org/bin/windows/base/)
  + на [Mac](https://cran.r-project.org/bin/macosx/)
  + на [Linux](https://cran.rstudio.com/bin/linux/)
* Затем [**RStudio**](https://www.rstudio.com/products/rstudio/download/)

Если что-то не установилось или вы предпочитаете облачные сервисы, то можно работать через браузер в [RStudio Cloud](https://rstudio.cloud/).


### А зачем обе штуки ставить?

Вопрос не безосновательный. Не углубляясь в мелкие детали, скажем так: R --- это собственно язык программирования, а RStudio --- это среда ([IDE](https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D1%80%D0%B5%D0%B4%D0%B0_%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B8), [integrated development environment](https://en.wikipedia.org/wiki/Integrated_development_environment)), которая позволяет в этом языке удобно и просто работать, а также расширяет его возможности.

> RStudio --- не единственная среда для работы в R, но, определённо, самая топовая. Почти все пользуются именно ею, и нет смысла искать что-то более удобное.

## Где спросить вопрос или искать ответ?
* [Google](https://google.com) --- препарат выбора
* [Stack Overflow](https://stackoverflow.com/) --- ответы на вопросы, и не только по R
* [Stack Overflow на русском](https://ru.stackoverflow.com/) --- то же самое, только отечественные специалисты
* [Cookbook for R](http://www.cookbook-r.com/) --- хорошая книжка для старта
* [RStudio Community](https://community.rstudio.com/) --- ответы на вопросы по R
* [R-bloggers](https://www.r-bloggers.com/) --- про новинки в R и рядом с ним
* [Хабр про R](https://habr.com/ru/hub/r/)
* …



## Интерфейс R
Можно, конечно, работать и без RStudio вовсе --- чисто в R. Мы кратенько взглянем на его интерфейс, чтобы наслаждение от встречи с IDE-шкой было больше.

КАРТИНКА

Выглядит весьма по-программистски. Есть окно скрипта, где пишутся команды, есть консоль, в которой они выполняются, иногда открываются окна с графиками. Но, в общем, посмотрели для общего развития --- и хватит. Пора серьезными делами заняться.



## Интерфейс RStudio
Итак, посмотрим на RStudio. При запуске у вас откроется что-то такое:

КАРТИНКА

Видно четыре (или три[^1]) окна. Давайте последовательно разбираться, что в каждом из них происходит.


### Console
В консоль можно писать команды и запускать их нажатием `Enter`. Они будут сразу выполняться. После некоторых команд будет выводиться какой-то результат. С помощью стрелок `↑` и `↓` можно вывести предыдущие команды, например, чтобы запустить их ещё раз, не вводя повторно, или каким-либо образом их изменить.

Можно, в прицнипе, работать только из консоли, но на практике это не очень удобно. Главным образом, из-за того, что команды улетают «вникуда» и к некоторым уже будет нельзя вернуться. Поэтому существует редактор кода.


### Code Editor
По своей сути это обычный блокнот с той лишь разницей, что здесь некоторые слова раскрашены. И в этом блокноте мы пишем _текст_ программы (скрипт), который состоит из комманд. Чтобы выполнить команду, нам необхожимо отправить её в консоль с помощью `Ctrl + Enter` (`Cmd + Enter`). Нажатие `Enter` здесь как и в обычном текстовом редакторе осуществляет переход на новую строку. Результат выполнения команды отображается в консоли, как будто вы изначально запускали команду там.

В консоли удобно что-то быстро поститать, скрипт же удобнее при работе с длинными командами и для сохранения кода (текста) для дальнейшей работы. Чтобы сохранить скрипт, сделайте `File → Save (as…)` или нажмите `Ctrl + S` (`Cmd + S`).

Несмотря на то, что файл сохраняется с расширением _.R_, это всё ещё обычный текст, который можно открыть и редактировать в любом текстовом редакторе (типа _Notebook_ или _TextEdit_).

> К вопросу _текста_ мы ещё вернёмся.


#### Кодировка
Компьютер умеет [хранить в памяти]() только цифры. А текст мы набираем буквами. Поэтому ему приходится перекодировать буквы в цифры. Делать это можно по-разному --- поэтому существуют разные _кодировки_.

При сохранении скрипта важно следить за кодировкой, особенно если в тексте встречаются кириллические знаки. В разных операционных систем разная кодировка по умолчанию, поэтому на другом компьютере файл может открываться с неведомой кракозяброй типа этой:

КАРТИНКА

Обычно при сохрании файла с кириллицей программа автоматически спрашивает, в какой кодировке его надо сохранить. Выбирайте `UTF-8` --- она корректно откроется в любой операционной системе. Также вы можете сохранить файл в определенной кодировке в помощью `File → Save with Encoding…`.

Если при открытии файла у вас отображается кракозябра, подобная той, которая показана выше, нужно узнать кодировку файла[^2] (для Win это обычно `ASCII`, для Mac --- `UTF-8`) и выполнить `File → Reopen with Encoding…`.


### Environment (Workspace) и History
Здесь, в Environment, можно наблюдать переменные и другие объекты, которые создаются в процессе работы кода, а также некоторую информацию о них. Это удобно, поскольку код, бывает, разрастается до сумасшедшего количества строк, и что вы там насоздавали тремястами строками выше --- уже и не упомнить. А тут всё под рукой.

В окне History можно найти историю команд, которые вы выполняли. Может быть полезно, чтобы не листать консоль, которая, как правило, завалена результатами и ошибками.


### Plots, Files, Packages, Help, Viewer
Очень полезное окно в кучей всего.

* сюда выводятся графики, которые вы строите
* здесь можно найти справку по функциям и пакетам
* проверить, какие у вас установлены пакеты и их версии
* посмотреть файлы в рабочей директории
* наблюдать 3D-визуализации, превью отчетов, презентаций и много чего ещё


## R как калькулятор
R --- полноценный язык программирования с множеством возможностей, но давайте начнём с малого. Первое, от чего стоит избавиться --- это страх консоли. Боязни калькулятора вроде не бывает (но это не точно[^3]), поэтому стартанём с этого.

### Арифметические операции
В R есть все привычные нам математические операции и операторы для них: `+`, `-`, `*`, `/`, `^`. Выполняются они тоже вполне предсказуемо:
```{r}
2 + 5 # сложение
10 - 4 # вычитание
3 * 7 # умножение
30 / 3 # деление
2 ^ 10 # возведение в степень
```

Также есть два особых деления:

```{r}
5 %/% 2 # целочисленное деление
5 %% 2 # взятие остатка от деления (5 mod 2)
```

<img class="taskimg" src="img/task.png">
<div class="task">
Попробуйте самостоятельно посчитать какие-нибудь простые примеры.
</div>

<center>
![](img/changing_stuff.jpeg)
</center>
<font size=1>
<p align="right">[_Source_](https://medium.com/@strayblues/gsoc-2018-changing-stuff-and-seeing-what-happens-c6694ec41d05)</p>
</font>

В R есть скобки --- `()`. Их назначение такое же, как и в математике. Порядок выполнения арифметических действий (приоритетов операторов[^4], *operator precedence*) тоже как в математике. Итого имеем:

```{r}
4 * 4 + 4
4 * (4 + 4)
5 * 5 ^ 5
(5 * 5) ^ 5
```

Так что используйте скобки, если вы не уверены, в каком порядке будут выполняться действия. Или смотрите таблицу приоритетор операторов по команде `?Syntax`.

### Функции
Но что, если нам надо посчитать что-то более сложное? Например, извлечь корень или вычислить логарифм? С корнем мы можем провернуть математический финт, если вспомним, что $\sqrt{x} = x^{\frac{1}{2}}$:

```{r}
4 ^ 0.5
```
Однако с логарифмом так уже не прокатит. Для вычисления подобных штук существуют _функции_. К вопросу, что есть функция, мы ещё не раз вернемся, а пока ограничимся самым общим пониманием: функция это некоторая команда, которая имеет вид `название_функции()`, просит что-то указать у себя в скобках (например, число) и после выполнения возвращает нам некоторый ответ (например, снова число).

На примере с квадратным корнем это выглядит так:

```{r}
sqrt(4)
```

> R чувствителен к регистру (case-sensitive), то есть `SQRT(4)` не сработает.

А вот логарифм:

```{r}
log(16)
```

Вот только здесь есть одна важная деталь.

<img class="taskimg" src="img/question.png">
<div class="task">
Какая?
</div>

Если мы вспомним определение логарифма, то окажется, что
$$\log_a b = c \Leftrightarrow a^c = b$$
> Логарифм некоторого числа --- это показатель степени, в которую нужно возвести _основание_, чтобы получить данное число.

Здесь придется чуть углубиться в **аргументы функции**. Аргументы --- это то самое «что-то», что мы записываем в скобках. 


<img class="taskimg" src="img/task.png">
<div class="task">
Посчитайте в R значения следующих выражений:

* $(\log_3 65)^7$
* $e^\sqrt[3]{5.5}$
* $\sin(8\pi + 4)$
* $\log \cos(-5\sqrt{12})$
* $\displaystyle 2\tan \log_{\sqrt{3}}8 + \sin^{(20\! \mod\! 3)} \Big(e  + \frac{8}{3}\Big)$
</div>


## Assignment и переменные


[^1]: При первом запуске может не быть окна Code Editor. Чтобы его открыть, сделайте `File → New File → R Script` или нажмите `Ctrl + Shift + N` (`Cmd + Shift + N`).
[^2]: Чтобы не возникало лишних вопросов, лучше снабдить папку с файлами документом README.md, где описать все важные детали, в том числе и кодировку файла. Об это ещё немного поговорим поздее.
[^3]: Бывает, что [вот это](https://psychtimes.com/logizomechanophobia-fear-of-computers/) распространяют и на калькуляторы тоже. [Кек]
[^4]: А вообще в разных языках программирования этот вопрос решается [по-разному](https://www.quora.com/Do-all-computer-languages-with-operator-precedence-use-the-same-operator-precedence).