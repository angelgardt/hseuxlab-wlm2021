# Оценивание параметров в практике статистического анализа {#statestim}

Мы оказываемся в сложной, но интересной ситуации. Мы хотим знать что-то про генеральную совокупность --- значение некоторого *параметра*. Но мы его никогда не узнаем, потому что не можем работать с целой генеральной совокупностью. Нам остаётся работать только с *выборочной совокупность (выборкой)* и опираться на статистические данные, которые мы собираем на ней.

Выборка извлекается из генеральной совокупности случайным образом, поэтому что там именно --- с точки зрения данных --- в нашей выборке будет нам также неизвестно. Отсюда происходят два ключевых свойства статистических данных --- *неопредлённость* и *вариативность*.

**Неопределённость** нам говорит о том, что мы не знаем, что именно мы получим в результате наших измерений для конкретной выборки. В том числе потому, что мы работаем на просторах случайных величин.

**Вариативность** означает, что наши данные будут различатся ещё и от респондента к респонденту. И между выборками тоже. Здесь и ошибка измерения, и различные смешения и ещё куча всего.

В итоге что мы имеем: так как нам не доступны *истинные* значения параметров, придётся использовать *оценки* этих параметров.


## Точечные оценки

Параметр обычно обозначается греческой буквой. Пусть у нас есть некоторый параметр генеральной совокупности $\theta$. Его аналогом на выборочной совокупности является его *точечная оценка* $\hat \theta$. Точечная она, потому что представляет собой некоторое одно число. Таким образом, это наиболее компактный способ составить представление о значении параметра. По своей сути она, на самом деле, она является функцией от результатов наблюдений:

$$
\hat \theta = \hat \theta (x), \; x = (x_1, x_2, \dots, x_n)
$$

Что это значит? То, что на разных выборках эта оценка может различаться. Возьмем для примера такой параметр как среднее значение. Предположим, что мы исследуем интеллект, и наша *генеральная совокупность* представлена таким набором наблюдений:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
theme_set(theme_bw())
```

```{r, echo=FALSE}
iq <- tibble(id = 1:10000, IQ = round(rnorm(10000, 100, 15)))
```

```{r}
nrow(iq)
head(iq)
tail(iq)
```

Так как мы предположили, что это генеральная совокупность, то мы можем посчитать истинное значение параметра $\mu$. **В реальной жизни мы этого сделать не можем!**

```{r}
mean(iq$IQ)
```

Вполне ожидаемое значение[^1]. Теперь попробуем наизвлекать выборок человек по 50 и посчитать *оценки среднего (выборочные средние)* $\hat \mu$ на них:

```{r}
means <- numeric()
for (i in 1:100) {
  means[i] <- mean(sample(iq$IQ, 50, replace = FALSE))
}
ggplot(NULL, aes(means)) +
  geom_histogram(binwidth = 1, fill = 'royalblue4', color = 'lightgray') +
  geom_vline(xintercept = mean(iq$IQ)) +
  labs(x = 'Выборочные средние IQ',
       y = 'Количество')
```

Наблюдаем, что иногда мы при подсчёте оценке параметра попадаем близко к истинному его значению, иногда промахиваемся. Собственно, как раз об этом *неопределённость и вариация*.


### Метод моментов

Чтобы получить точечные оценки параметров, используются разные методы в зависимости от конкретной модели анализа. Сейчас мы познакомимся с самым простым --- **методом моментов**. Другие разберем, когда с ними столкнёмся.

Само название метода отсылает нас к обсуждению [характеристик распределений случайных величин](#moments_distributions). Мы говорили о том, что распредления характеризуются их *моментами*. В методе моментов есть три этапа:

1) устанавливается связь между оцениваемым параметром и моментом распределения

$$
\theta = \xi(\nu_k) \quad \text{или} \quad \theta = \xi(\mu_k)
$$

2) находятся выборочные моменты

$$
\hat \theta = \xi(\nu_k^*) \quad \text{или} \quad \hat \theta = \xi(\mu_k^*)
$$

3) истинный момент заменяется на выборочный --- получается оценка.

Для примера разберём всё тот же датасет с IQ. Мы знаем, что распределение баллов IQ подчинается [нормальному закону](#normal_distribution). Поэтому в качестве параметра «среднее значение коэффициента интеллекта» генеральной совокупности можно использовать математическое ожидание:

$$
\mu = \mathbb{E}X
$$

Выборочным аналогом математического ожидания является выборочное среднее:

$$
\hat \mu = \frac{1}{n} \sum_{i=1}^n x_i
$$

И это, собственно, всё. Если вы хотя бы раз анализировали данные, вы имплицитно пользовались этим знанием. Просто, скорее всего, не задумывались, что это так работает. :)


### Свойства точечных оценок

Так как точечные оценки всё же оценки, мы можем и промахнуться мимо истинного среднего --- это мы наблюдали на гистограмме. Поэтому нам надо предъявить определённые требования к точечным оценкам. Их три: *несмещённость*, *состоятельность* и *эффективность*.

#### Несмещённость

**Несмещённость** выражает следующую идею: когда мы рассчитываем выборочную оценку, мы должны как можно ближе попадать в истинное значение параметра.

$$
\forall n \; \mathbb{E} \hat \theta = \theta, \quad (\mathbb{E}\hat \theta - \theta) \rightarrow 0,
$$
где $n$ --- объём выборки, $(\mathbb{E}\hat \theta - \theta)$ --- смещение.

Слева представлено требование *несмещённости при любом объёме выборки*, а справа --- *ассимптотической несмещённости*.


#### Состоятельность

Математически **состоятельность** определяется следующим образом:

$$
\lim_{n \rightarrow \infty} \mathrm{P}(|\hat \theta - \theta| < \varepsilon) = 1, \, \varepsilon > 0
$$

Содержательно эта запись нам говорит следующее, что при неограниченном росте мощности выборки наша оценка стремится к истинному значению параметра. Может быть, такая формулировка не совсем точна математически, но позволяет представить, что происходит. 


#### Эффективность

Эффективность точечной оценки определяется достаточно просто. Так как оценка параметра --- это случайная величина, но у неё есть *дисперсия*. Чтобы оценка была **эффективна**, её дисперсия должна быть минимальной:

$$
\sigma^2_{\hat \theta} = \min
$$

Пример несмещённой, состоятельной и эффективной оценки --- это выборочное среднее для оценки математического ожидания нормально распределённой величины. Именно то, что мы и делали в примере применения метода моментов.


## Интервальные оценки


### Доверительный интервал {#confinterval}




[^1]: Шкала IQ устроена так, что её среднее значение равно 100, а стандартное отклонение 15.
